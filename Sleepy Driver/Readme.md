ğŸ˜´ Drowsiness Detection Program ğŸš™
============================

Project Overview ğŸ–¥ï¸
---------------------------
### ê°œë°œ í™˜ê²½
  > window10, python3.10, pycharm23.2.5, teachable machine
### ê°œë°œ ëª©ì 
  > ì¡¸ìŒìš´ì „ìœ¼ë¡œ ì¸í•œ êµí†µì‚¬ê³ ëŠ” 2017ë…„ì— 2002ê±´, 2018ë…„ì— 1308ê±´, 2019ë…„ì— 2887ê±´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. ìŒì£¼ìš´ì „ê³¼ ë‹¤ë¥´ê²Œ ì¡¸ìŒìš´ì „ì€ ìì‹ ì˜ ì˜ì§€ë§Œìœ¼ë¡œëŠ” ì´ê²¨ë‚´ê¸° ì–´ë µë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¡¸ìŒì‰¼í„° ë˜ëŠ” íœ´ê²Œì†Œì— ì ì‹œ íœ´ì‹ì„ ì·¨í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ì‚¬ê³  ì˜ˆë°©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ì¡¸ìŒì˜ ê¸°ì¤€ì„ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í”„ë¡œê·¸ë¨ì—ì„œ ê²½ê³ í•˜ë©´ íœ´ì‹ í•„ìš”ì„±ì„ ì¸ì§€í•˜ê³  í–‰ë™í•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ì„ ê°œë°œí•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.   
![ì¡¸ìŒìš´ì „ êµí†µì‚¬ê³ ](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/1a4db201-f1a7-457b-8794-c8e22843d510)   
(ê³µê³µë°ì´í„° í¬í„¸ì—ì„œ ì œê³µëœ ê²½ì°°ì²­ ì‚¬ê³  í˜„í™© ë°ì´í„°, https://www.data.go.kr/data/15047952/fileData.do)
### ê¸°ëŠ¥
  > ìº ì„ í†µí•´ì„œ ëˆˆì„ ê°ì€ ìƒíƒœ ì¹´ìš´íŠ¸ê°€ 15ê°€ ë  ê²½ìš° ê²½ê³ ìŒê³¼ í•¨ê»˜ ì „êµ­ íœ´ê²Œì†Œì™€ ì¡¸ìŒì‰¼í„° ìœ„ì¹˜ê°€ í‘œì‹œëœ ì§€ë„ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤. ì§€ë„ì—ëŠ” íœ´ê²Œì†Œì™€ ì¡¸ìŒì‰¼í„°ë¥¼ êµ¬ë³„í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì²´í¬ë°•ìŠ¤ê°€ ìˆìœ¼ë©°, ìœ„ì¹˜ í´ë¦­ì‹œ í™”ì¥ì‹¤, ìŒì‹ì , í¸ì˜ì‹œì„¤ì— ëŒ€í•œ ë¶€ê°€ì ì¸ ì •ë³´ê°€ ìˆëŠ” íŒì—… ì°½ì´ í‘œì‹œë©ë‹ˆë‹¤.
   
-----------------------------
   
âœ¨ Project Description âœ¨
-----------------------------
+ í´ë” ë° íŒŒì¼ ì„¤ëª…
  - data_set   
    : teachable machineì—ì„œ close_samplesê³¼ open_samplesì„ ê°ê° 1500ê°œì˜ ì´ë¯¸ì§€ë¡œ í•™ìŠµì‹œí‚¨ ë°ì´í„° í´ë”.
  - rest area data   
    : ì§€ë„ì— í‘œì‹œë˜ëŠ” íœ´ê²Œì†Œì™€ ì¡¸ìŒì‰¼í„° ë°ì´í„° íŒŒì¼ë¡œ ê³µê³µë°ì´í„° í¬í„¸ì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ìŒ.   
  - Drowsiness_Detection.py   
    : í”„ë¡œê·¸ë¨ì´ ì§„í–‰ë˜ëŠ” python source code.   
  - alarm.wav   
    : ëˆˆì„ 15ì´ˆ ì´ìƒ ê°ì•„ ì¡¸ìŒìœ¼ë¡œ ê°ì§€í•˜ë©´ ìš¸ë¦¬ëŠ” ê²½ê³ ìŒ   
  - keras_model.h5   
    : teachable machineì—ì„œ í•™ìŠµ í›„ ëª¨ë¸ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œ ë°›ì€ opencv_keras model.   
  - korea.html   
    : íœ´ê²Œì†Œì™€ ì¡¸ìŒì‰¼í„°ê°€ í‘œì‹œë˜ëŠ” ì§€ë„ html.
  - labels.txt   
    : keras modelì— ëŒ€í•œ labelë¡œ 0ì€ open eyes, 1ì€ close eyesë¥¼ ëœ»í•¨.
    
+  ê°œë°œ ê³¼ì • ì„¤ëª…   
   - teachable machine ëª¨ë¸ ì„¤ëª…   
     í•™ìŠµ í›„ ì œê³µë˜ëŠ” keras_model.h5, labels.txt, source code í™œìš©
    ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/578abd74-db71-45a1-88b6-38b12ecc5b36)   
    ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/86088bde-b10c-43e7-a4fb-86ae7cde54f4)   

   - <Drowsiness_Detection.py> ì½”ë“œ ì„¤ëª…   
    ``` python
    import pandas as pd
    import folium
    import webbrowser
    from keras.models import load_model
    import cv2
    import numpy as np
    import winsound
    import time
    ```
    > pip install and import library í•„ìš”   
    > pandasëŠ” csv íŒŒì¼ ì½ê¸°, foliumì€ ì§€ë„ ë§ˆí‚¹, webbrowserëŠ” ì§€ë„ ì €ì¥ ë° ì¶œë ¥, load_modelì€ keras.model ì½ê¸°, cv2ëŠ” pip install opencv-python í•„ìš”í•˜ë©° ì›¹ìº  ì‚¬ìš©, numpyëŠ” ëª¨ë¸ ì—°ì‚°, winsoundëŠ” ê²½ê³ ìŒ ì¶œë ¥, timeì€ count ëˆ„ì ì— ëŒ€í•œ ì‹œê°„ ì´ˆ ë¶€ì—¬   
    ```
    sleep_count = 0
    ```
    > sleep_count ë³€ìˆ˜ ì²˜ìŒì— 0ìœ¼ë¡œ ì´ˆê¸°í™”
    ```
    # Disable scientific notation for clarity
    np.set_printoptions(suppress=True)
    
    # Load the model
    model = load_model("keras_model.h5", compile=False)
    
    # Load the labels
    class_names = open("labels.txt", "r").readlines()
    
    # CAMERA can be 0 or 1 based on default camera of your computer
    camera = cv2.VideoCapture(0)
    
    while True:
        # Grab the webcamera's image.
        ret, image = camera.read()
    
        # Resize the raw image into (224-height,224-width) pixels
        image = cv2.resize(image, (224, 224))
    
        # Show the image in a window
        cv2.imshow("Webcam Image", image)
    
        # Make the image a numpy array and reshape it to the models input shape.
        image = np.asarray(image, dtype=np.float32).reshape(1, 224, 224, 3)
    
        # Normalize the image array
        image = (image / 127.5) - 1
    
        # Predicts the model
        prediction = model.predict(image)
        index = np.argmax(prediction)
        class_name = class_names[index]
        confidence_score = prediction[0][index]
    
        # Print prediction and confidence score
        print("Class:", class_name[2:], end="")
        print("Confidence Score:", str(np.round(confidence_score * 100))[:-2], "%")
    
        # Listen to the keyboard for presses.
        keyboard_input = cv2.waitKey(1)
    ```
    > keras.model ì‚¬ìš©ì— ëŒ€í•œ ì½”ë“œ
    
    ```
    # close ì¸ì‹í•  ë•Œë§ˆë‹¤ sleep_count 1 ì¦ê°€
    if class_name == class_names[1]:
      sleep_count += 1
      time.sleep(0.1)
      print (sleep_count)
    # open ì¸ì‹í•˜ë©´ sleep_count 0ìœ¼ë¡œ ì´ˆê¸°í™”
    else:
      sleep_count = 0
    ```
    > ìº ì—ì„œ closeë¡œ ì¸ì‹í•˜ë©´ sleep_count 1ì”© ì¦ê°€í•˜ë©° openìœ¼ë¡œ ì¸ì‹í•˜ë©´ count 0ìœ¼ë¡œ ì´ˆê¸°í™”
    ```
    # sleep_count 15ê¹Œì§€ ëˆ„ì ë˜ë©´ ì¡¸ìŒì‰¼í„°ì™€ íœ´ê²Œì†Œ ì •ë³´ìˆëŠ” ì§€ë„ì™€ ì•ŒëŒ ì¶œë ¥
    if sleep_count == 15:
      rest = pd.read_csv('ì „êµ­ì¡¸ìŒì‰¼í„°í‘œì¤€ë°ì´í„°.csv', encoding='cp949')
      area = pd.read_csv('ì „êµ­íœ´ê²Œì†Œì •ë³´í‘œì¤€ë°ì´í„°.csv', encoding='cp949')
    
    # ì§€ë„ ê¸°ì¤€ ìœ„ì¹˜ 'ì„œìš¸ê³¼í•™ê¸°ìˆ ëŒ€í•™êµ'
    m = folium.Map(
        location=[float(37.63186), float(127.0775)],
        zoom_start=10
        )
    
    tooltip = 'Click'
        # ì¡¸ìŒì‰¼í„°ì™€ íœ´ê²Œì†Œ ê·¸ë£¹ì„¤ì •í•˜ì—¬ ë¶„ë¦¬
        ì¡¸ìŒì‰¼í„° = folium.FeatureGroup(name='ì¡¸ìŒì‰¼í„°').add_to(m)
        íœ´ê²Œì†Œ = folium.FeatureGroup(name='íœ´ê²Œì†Œ').add_to(m)

    # ì¡¸ìŒì‰¼í„° data ì§€ë„ì— ë§ˆí‚¹
        for i in range(rest.shape[0]):
            folium.Marker(
                [rest.iloc[i]['ìœ„ë„'], rest.iloc[i]['ê²½ë„']],
                popup=f'<div style="width:200px"><strong>ì¡¸ìŒì‰¼í„°ëª…: {rest.iloc[i]["ì¡¸ìŒì‰¼í„°ëª…"]}</strong><br>'
                      f'<br>'
                      f'ë„ë¡œë…¸ì„ ëª…: {rest.iloc[i]["ë„ë¡œë…¸ì„ ëª…"]}<br>'
                      f'ë„ë¡œë…¸ì„ ë°©í–¥: {rest.iloc[i]["ë„ë¡œë…¸ì„ ë°©í–¥"]}<br>'
                      f'í™”ì¥ì‹¤: {rest.iloc[i]["í™”ì¥ì‹¤ìœ ë¬´"]}<br> </div >',
                tooltip=tooltip,
                icon=folium.Icon(color='green', icon='star')
            ).add_to(ì¡¸ìŒì‰¼í„°)

    # íœ´ê²Œì†Œ data ì§€ë„ì— ë§ˆí‚¹
        for i in range(area.shape[0]):
            folium.Marker(
                [area.iloc[i]['ìœ„ë„'], area.iloc[i]['ê²½ë„']],
                popup=f'<div style="width:300px"><strong>íœ´ê²Œì†Œëª…: {area.iloc[i]["íœ´ê²Œì†Œëª…"]}</strong><br>'
                      f'<br>'
                      f'ë„ë¡œë…¸ì„ ëª…: {area.iloc[i]["ë„ë¡œë…¸ì„ ëª…"]}<br>'
                      f'ë„ë¡œë…¸ì„ ë°©í–¥: {area.iloc[i]["ë„ë¡œë…¸ì„ ë°©í–¥"]}<br>'
                      f'íœ´ê²Œì†Œ ìš´ì˜ì‹œê°„: {area.iloc[i]["íœ´ê²Œì†Œìš´ì˜ì‹œì‘ì‹œê°"]} ~ {area.iloc[i]["íœ´ê²Œì†Œìš´ì˜ì¢…ë£Œì‹œê°"]}<br>'
                      f'í™”ì¥ì‹¤: {area.iloc[i]["í™”ì¥ì‹¤ìœ ë¬´"]}<br>'
                      f'ê²½ì •ë¹„ ê°€ëŠ¥: {area.iloc[i]["ê²½ì •ë¹„ê°€ëŠ¥ì—¬ë¶€"]}<br>'
                      f'ì£¼ìœ ì†Œ: {area.iloc[i]["ì£¼ìœ ì†Œìœ ë¬´"]} | LPG ì¶©ì „ì†Œ: {area.iloc[i]["LPGì¶©ì „ì†Œìœ ë¬´"]} | ì „ê¸°ì°¨ ì¶©ì „ì†Œ: {area.iloc[i]["ì „ê¸°ì°¨ì¶©ì „ì†Œìœ ë¬´"]}<br>'
                      f'í¸ì˜ì‹œì„¤: ì•½êµ­{area.iloc[i]["ì•½êµ­ìœ ë¬´"]} ìˆ˜ìœ ì‹¤{area.iloc[i]["ìˆ˜ìœ ì‹¤ìœ ë¬´"]} ë§¤ì {area.iloc[i]["ë§¤ì ìœ ë¬´"]}<br>'
                      f'ìŒì‹ì : {area.iloc[i]["ìŒì‹ì ìœ ë¬´"]} (ëŒ€í‘œìŒì‹ : {area.iloc[i]["íœ´ê²Œì†ŒëŒ€í‘œìŒì‹ëª…"]})<br>'
                      f'</div >',
                tooltip=tooltip,
                icon=folium.Icon(color='red', icon='star')
            ).add_to(íœ´ê²Œì†Œ)
    ```
    > sleep_countê°€ 15ê°€ ë˜ë©´ ë°ì´í„° íŒŒì¼ ì½ì–´ì˜¨ë‹¤.   
    > folium ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µí•´ ì§€ë„ì— íœ´ê²Œì†Œì™€ ì¡¸ìŒì‰¬í„° ìœ„ì¹˜ ë° ë¶€ê°€ì •ë³´ë¥¼ í‘œì‹œ   
    > green markëŠ” ì¡¸ìŒì‰¼í„°, red markëŠ” íœ´ê²Œì†Œë¡œ í‘œì‹œ   
    ```
    # ì¡¸ìŒì‰¼í„°, íœ´ê²Œì†Œ ê·¸ë£¹ ì²´í¬ë°•ìŠ¤
    folium.LayerControl(collapsed=False).add_to(m)

    # korea ì§€ë„ htmlì— ì €ì¥ ë° ì¶œë ¥
    m.save('korea.html')
    filepath = "korea.html"
    webbrowser.open_new_tab(filepath)

    # ì¡¸ìŒ ê°ì§€ë¡œ ì¸í•œ ê²½ê³ ìŒ ì¶œë ¥
    winsound.PlaySound("alarm.wav", winsound.SND_FILENAME)

    # sleep_count 0ìœ¼ë¡œ ì´ˆê¸°í™”
    sleep_count = 0
    ```
    > ì¡¸ìŒì‰¼í„°ì™€ íœ´ê²Œì†Œë¥¼ ë¶„ë¦¬í•˜ì—¬ ë³¼ ìˆ˜ ìˆë„ë¡ ì²´í¬ë°•ìŠ¤ ìƒì„±   
    > korea.htmlì— ë°ì´í„° ì €ì¥ ë° ì¶œë ¥   
    > ì¡¸ìŒ ê°ì§€ ê²½ê³ ìŒ ì¶œë ¥ í›„ sleep_count 0ìœ¼ë¡œ ì´ˆê¸°í™”   
    ```
    # 27 is the ASCII for the esc key on your keyboard.
    if keyboard_input == 27:
        break

    camera.release()
    cv2.destroyAllWindows()
    ```
    > í”„ë¡œê·¸ë¨ ì¢…ë£Œ ìœ„í•œ ì½”ë“œ
+ Program ì‹¤í–‰ ì„¤ëª…
  ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/389e7e3a-f09d-41b0-aa0e-7f3528358216)
  ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/d90f1fc5-b73e-44b4-84a9-4a0c1555e8e0)
  ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/fdacdbf7-fc8c-4cf5-b22a-6d2be2923d61)
  ![image](https://github.com/Jeonsowon/Jeonsowon/assets/144200709/bb3badd5-d778-4169-a83b-7fc1ad861787)
  > í•œêµ­ë§Œ ë°ì´í„° ì ìš©   
-----------------------------
Reference ğŸ™
-----------------------------
+ https://blog.naver.com/ysjang0102/223021863973 (Teachable machine ì´ìš©í•œ ì½”ë“œ êµ¬ìƒ ì°¸ì¡°)
+ https://www.data.go.kr/data/15028203/standard.do (ì¡¸ìŒì‰¼í„° ë°ì´í„° ë‹¤ìš´ë¡œë“œ)
+ https://www.data.go.kr/data/15025446/standard.do (íœ´ê²Œì†Œ ë°ì´í„° ë‹¤ìš´ë¡œë“œ)

Developer ğŸ™‹
-----------------------------
+ 21102318 ì „ì†Œì›
